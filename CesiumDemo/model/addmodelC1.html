<!--
 * @Date: 2024-06-13 19:13:58
 * @LastEditors: likai 2806699104@qq.com
 * @LastEditTime: 2024-06-26 13:50:37
 * @FilePath: \cshiDemo\cesium\model\addmodelC1.html
 * @Description: 文件描述 && Do not edit
-->
<!-- cesium 3D 添加点云-->
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>添加点云dom</title>
    <!-- <link href="https://cesium.com/downloads/cesiumjs/releases/1.98/Build/Cesium/Widgets/widgets.css" rel="stylesheet" />
    <script src="https://cesium.com/downloads/cesiumjs/releases/1.98/Build/Cesium/Cesium.js"></script> -->
    <link rel="stylesheet" href="../CesiumUnminified/Widgets/widgets.css">
    <script src="../CesiumUnminified/Cesium.js"></script>
   <style>
        html,
        body,
        #cesiumContainer {
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden;
        }
    </style>

    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Document</title>
    </head>

<body>
    <div id="cesiumContainer"></div>
</body>

</html>
<!-- <script type="module" src="filterColor.js"></script> -->
<script>
       Cesium.Ion.defaultAccessToken =
        "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiJjNzRiNzNkYS0zZTRmLTRhOTMtODFlNS0zOWFhN2FmYzZmYjkiLCJpZCI6MTUyMTEwLCJpYXQiOjE2ODg2OTYyMDl9.sWkoSUmLFPfbMTMFgAZeQKjBQERg-TZPBBtIN34sDNQ";
    let viewer = new Cesium.Viewer("cesiumContainer", {
        terrainProvider: Cesium.createWorldTerrain()
    });

// //定位到该地点
// viewer.camera.flyTo({
// 	destination : Cesium.Cartesian3.fromDegrees(112.96906,34.70736,5000.0)
// });
// viewer.imageryLayers.removeAll()
const tileset = new Cesium.Cesium3DTileset({ 
    url: "./pv/tileset.json",    
}); 
          
modifyMap(viewer, {
    //反色?
    invertColor: true,
    //滤色值
    filterRGB: [0, 1, 0],
});
viewer.scene.primitives.add(tileset);

viewer.zoomTo(tileset);

function modifyMap(viewer, options) {
    const baseLayer = viewer.imageryLayers.get(0)
    //以下几个参数根据实际情况修改,目前我是参照火星科技的参数,个人感觉效果还不错
    baseLayer.brightness = options.brightness || 0.6
    baseLayer.contrast = options.contrast || 1.8
    baseLayer.gamma = options.gamma || 0.3
    baseLayer.hue = options.hue || 1
    baseLayer.saturation = options.saturation || 0
    const baseFragShader = (viewer.scene.globe)._surfaceShaderSet
        .baseFragmentShaderSource.sources
    for (let i = 0; i < baseFragShader.length; i++) {
        const strS = 'color = czm_saturation(color, textureSaturation);\n#endif\n'
        let strT = 'color = czm_saturation(color, textureSaturation);\n#endif\n'
        if (options.invertColor) {
            strT += `
      color.r = 1.0 - color.r;
      color.g = 1.0 - color.g;
      color.b = 1.0 - color.b;
      `
        }
        if (options.filterRGB.length > 0) {
            strT += `
      color.r = color.r * ${options.filterRGB[0]}.0/255.0;
      color.g = color.g * ${options.filterRGB[1]}.0/255.0;
      color.b = color.b * ${options.filterRGB[2]}.0/255.0;
      `
        }
        baseFragShader[i] = baseFragShader[i].replace(strS, strT)
    }
}
</script>